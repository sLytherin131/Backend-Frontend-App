<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reservation System</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            padding: 0;
        }
        h1, h2 {
            color: #333;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        table, th, td {
            border: 1px solid #ddd;
        }
        th, td {
            padding: 10px;
            text-align: left;
        }
        th {
            background-color: #f4f4f4;
        }
        form {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input, select, button {
            margin-bottom: 10px;
            padding: 8px;
            width: 100%;
        }
        button {
            background-color: #007BFF;
            color: white;
            border: none;
            cursor: pointer;
        }
        button:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>
    <h1>Reservation System</h1>

    <!-- Section for Fields -->
    <h2>Lapangan</h2>
    <form id="fieldForm">
        <label for="fieldName">Nama Lapangan:</label>
        <input type="text" id="fieldName" required>
        
        <label for="fieldType">Jenis Lapangan:</label>
        <input type="text" id="fieldType" required>
        
        <label for="fieldPrice">Harga per Jam:</label>
        <input type="number" id="fieldPrice" min="1" required>
        
        <button type="submit">Tambah Lapangan</button>
    </form>
    <table id="fieldsTable">
        <thead>
            <tr>
                <th>ID</th>
                <th>Nama</th>
                <th>Jenis</th>
                <th>Harga/Jam</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <!-- Section for Customers -->
    <h2>Pelanggan</h2>
    <form id="customerForm">
        <label for="customerName">Nama Pelanggan:</label>
        <input type="text" id="customerName" required>
        
        <label for="customerPhone">Nomor Telepon:</label>
        <input type="text" id="customerPhone" required>
        
        <button type="submit">Tambah Pelanggan</button>
    </form>
    <table id="customersTable">
        <thead>
            <tr>
                <th>ID</th>
                <th>Nama</th>
                <th>Nomor Telepon</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <!-- Section for Reservations -->
    <h2>Reservasi</h2>
    <form id="reservationForm">
        <label for="fieldDropdown">Lapangan:</label>
        <select id="fieldDropdown"></select>
        
        <label for="customerDropdown">Pelanggan:</label>
        <select id="customerDropdown"></select>
        
        <label for="startTime">Waktu Mulai:</label>
        <input type="datetime-local" id="startTime" required>
        
        <label for="duration">Durasi (jam):</label>
        <input type="number" id="duration" min="1" required>
        
        <button type="submit">Tambah Reservasi</button>
    </form>
    <table id="reservationsTable">
        <thead>
            <tr>
                <th>ID</th>
                <th>Lapangan</th>
                <th>Pelanggan</th>
                <th>Waktu Mulai</th>
                <th>Durasi</th>
                <th>Total Harga</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <script>
        const apiBaseUrl = "http://127.0.0.1:3000";
    
        // Data caches for mapping IDs to names
        let fieldMap = {};
        let customerMap = {};
    
        // Load Fields
        function loadFields() {
            fetch(`${apiBaseUrl}/fields`)
                .then(response => response.json())
                .then(fields => {
                    const tableBody = document.getElementById("fieldsTable").querySelector("tbody");
                    const dropdown = document.getElementById("fieldDropdown");
                    tableBody.innerHTML = "";
                    dropdown.innerHTML = "";
    
                    fields.forEach(field => {
                        fieldMap[field.id] = field.name; // Save field ID-to-name mapping
                        tableBody.innerHTML += `
                            <tr>
                                <td>${field.id}</td>
                                <td>${field.name}</td>
                                <td>${field.type}</td>
                                <td>${field.price_per_hour}</td>
                            </tr>
                        `;
                        dropdown.innerHTML += `<option value="${field.id}">${field.name}</option>`;
                    });
                })
                .catch(error => console.error("Error loading fields:", error));
        }
    
        // Load Customers
        function loadCustomers() {
            fetch(`${apiBaseUrl}/customers`)
                .then(response => response.json())
                .then(customers => {
                    const tableBody = document.getElementById("customersTable").querySelector("tbody");
                    const dropdown = document.getElementById("customerDropdown");
                    tableBody.innerHTML = "";
                    dropdown.innerHTML = "";
    
                    customers.forEach(customer => {
                        customerMap[customer.id] = customer.name; // Save customer ID-to-name mapping
                        tableBody.innerHTML += `
                            <tr>
                                <td>${customer.id}</td>
                                <td>${customer.name}</td>
                                <td>${customer.phone_number}</td>
                            </tr>
                        `;
                        dropdown.innerHTML += `<option value="${customer.id}">${customer.name}</option>`;
                    });
                })
                .catch(error => console.error("Error loading customers:", error));
        }
    
        // Load Reservations
        function loadReservations() {
            fetch(`${apiBaseUrl}/reservations`)
                .then(response => response.json())
                .then(reservations => {
                    const tableBody = document.getElementById("reservationsTable").querySelector("tbody");
                    tableBody.innerHTML = "";
    
                    reservations.forEach(reservation => {
                        const fieldName = fieldMap[reservation.field_id] || "Unknown Field";
                        const customerName = customerMap[reservation.customer_id] || "Unknown Customer";
                        const startTime = new Date(reservation.start_time).toLocaleString();
                        tableBody.innerHTML += `
                            <tr>
                                <td>${reservation.id}</td>
                                <td>${fieldName}</td>
                                <td>${customerName}</td>
                                <td>${startTime}</td>
                                <td>${reservation.duration} jam</td>
                                <td>${reservation.total_cost}</td>
                            </tr>
                        `;
                    });
                })
                .catch(error => console.error("Error loading reservations:", error));
        }
    
        // Form Submissions (unchanged)
        document.getElementById("fieldForm").addEventListener("submit", function (e) {
            e.preventDefault();
            const name = document.getElementById("fieldName").value;
            const type = document.getElementById("fieldType").value;
            const price = parseFloat(document.getElementById("fieldPrice").value);
    
            fetch(`${apiBaseUrl}/fields`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ name, type, price_per_hour: price })
            })
                .then(() => {
                    loadFields();
                    alert("Lapangan berhasil ditambahkan!");
                })
                .catch(error => console.error("Error adding field:", error));
        });
    
        document.getElementById("customerForm").addEventListener("submit", function (e) {
            e.preventDefault();
            const name = document.getElementById("customerName").value;
            const phone = document.getElementById("customerPhone").value;
    
            fetch(`${apiBaseUrl}/customers`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ name, phone_number: phone })
            })
                .then(() => {
                    loadCustomers();
                    alert("Pelanggan berhasil ditambahkan!");
                })
                .catch(error => console.error("Error adding customer:", error));
        });
    
        document.getElementById("reservationForm").addEventListener("submit", function (e) {
            e.preventDefault();
            const fieldId = parseInt(document.getElementById("fieldDropdown").value);
            const customerId = parseInt(document.getElementById("customerDropdown").value);
            const startTimeInput = document.getElementById("startTime").value;
            const duration = parseInt(document.getElementById("duration").value);
    
            const startTime = new Date(startTimeInput).toISOString();
    
            fetch(`${apiBaseUrl}/reservations`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    field_id: fieldId,
                    customer_id: customerId,
                    start_time: startTime,
                    duration: duration,
                }),
            })
                .then(response => {
                    if (!response.ok) {
                        throw new Error("Gagal menambahkan reservasi!");
                    }
                    return response.json();
                })
                .then(() => {
                    loadReservations();
                    alert("Reservasi berhasil ditambahkan!");
                })
                .catch(error => console.error("Error adding reservation:", error));
        });
    
        // Load initial data
        loadFields();
        loadCustomers();
        loadReservations();
    </script>
    
</body>
</html>
